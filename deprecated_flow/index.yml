jtype: Flow
version: '1'
executors:
  - name: segmenter
    uses: IndexSentenceSegmenter
  - name: encoder
    uses: 'jinahub://TransformerTFTextEncoder'
    parallel: 3
    uses_with:
      pretrained_model_name_or_path: 'hfl/chinese-legal-electra-small-generator'
      default_batch_size: 32
      on_gpu: false
      max_length: 256
      default_traversal_paths:
        - 'c'
  - name: chunk_indexer
    uses: 'jinahub://PostgreSQLStorage'
    uses_with:
      table: 'chunk_indexer_legal_electra_table'
      default_traversal_paths:
        - 'c'
    uses_metas:
      workspace: ${JINA_WORKSPACE_CHUNK}
  - name: doc_indexer
    uses: 'jinahub://PostgreSQLStorage'
    uses_with:
      table: 'doc_indexer_table'
      default_traversal_paths:
        - 'r'
    uses_metas:
      workspace: ${JINA_WORKSPACE_DOC}
    needs: gateway
  - name: joiner
    needs: [chunk_indexer, doc_indexer]
